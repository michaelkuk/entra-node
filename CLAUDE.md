# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is a TypeScript/Node.js project for working with Microsoft Entra ID (formerly Azure AD). The project uses the Microsoft Graph API via the official SDK to interact with Entra ID resources.

## Project Structure

- **src/**: TypeScript source files
- **dist/**: Compiled JavaScript output (generated by build)
- **output/**: Directory for generated CSV files or other output
- **node_modules/**: Dependencies (excluded from git)

## Common Commands

### Development
```bash
# Install dependencies
npm install

# Run in development mode (ts-node)
npm run dev

# Build TypeScript to JavaScript
npm run build

# Build and run compiled code
npm start
```

### Code Quality
```bash
# Lint TypeScript files
npm run lint

# Lint and auto-fix issues
npm run lint:fix

# Format code with Prettier
npm run format

# Check formatting without changes
npm run format:check
```

### Testing
```bash
# Run all tests
npm test

# Run tests in watch mode (re-runs on file changes)
npm run test:watch

# Run tests with coverage report
npm run test:coverage

# Run only unit tests
npm run test:unit

# Run only integration tests (requires credentials)
npm run test:integration

# Run tests in CI mode
npm run test:ci

# Run specific test file
npm test -- tests/unit/services/graphService.test.ts

# Run tests matching pattern
npm test -- --testNamePattern="getUserById"
```

### Cleanup
```bash
# Remove compiled output
npm run clean
```

## Technical Stack

**Runtime & Language:**
- Node.js (ES2022 target)
- TypeScript 5.9+ with strict mode enabled
- CommonJS module system

**Key Dependencies:**
- `@azure/identity` - Azure authentication (device code flow)
- `@microsoft/microsoft-graph-client` - Microsoft Graph API SDK
- `csv-writer` - CSV file generation
- `p-limit` - Concurrency control for parallel operations

**Development Tools:**
- ESLint with TypeScript plugin
- Prettier for code formatting
- ts-node for development execution
- Jest with ts-jest for unit and integration testing

## TypeScript Configuration

- Strict mode enabled for type safety
- Source maps and declarations generated
- Output directory: `./dist`
- Targets ES2022 with CommonJS modules

## Code Style

- ESLint enforces TypeScript best practices
- Prettier handles formatting (integrated with ESLint)
- **IMPORTANT: Always format edited files with Prettier after making changes** (`npm run format`)
- Unused variables prefixed with `_` are allowed
- `console` statements are permitted (common for CLI tools)
- `@typescript-eslint/no-explicit-any` is a warning, not an error

## Authentication

The project uses Azure authentication via `@azure/identity`. Typical pattern is device code authentication for interactive CLI applications working with Microsoft Graph API.

## Testing Strategy

**Test Organization:**
- `tests/unit/` - Fast, isolated unit tests with mocked dependencies
- `tests/integration/` - Slower integration tests (skipped by default, require real credentials)
- `tests/__mocks__/` - Manual mocks for external dependencies (@azure/identity, @microsoft/microsoft-graph-client)
- `tests/fixtures/` - Reusable test data and fixtures
- `tests/setup.ts` - Global test configuration

**Testing Guidelines:**
- Write unit tests for all business logic in `src/services/` and `src/utils/`
- Mock external dependencies (Microsoft Graph API, Azure Identity)
- Maintain 70%+ code coverage (enforced in jest.config.js)
- Use `describe.skip()` for integration tests that require real API access
- Name test files with `.test.ts` or `.spec.ts` suffix
- Place tests in `tests/unit/` mirroring the `src/` directory structure

**Running Tests:**
- Unit tests run by default with `npm test`
- Integration tests are skipped unless explicitly requested
- Coverage reports generated in `./coverage` directory
- See `tests/README.md` for detailed testing guide and best practices

## Development Notes

- Entry point: `src/index.ts` (compiled to `dist/index.js`)
- The project structure suggests batch/parallel processing capabilities (p-limit dependency)
- CSV output indicates data export functionality
- Output files should be written to the `./output` directory
- Test fixtures available in `tests/fixtures/` for consistent test data
- Mock implementations for Azure and Graph clients in `tests/__mocks__/`
